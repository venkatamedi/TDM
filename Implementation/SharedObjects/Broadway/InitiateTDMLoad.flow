{
    "levels": [
        {
            "stages": [
                {
                    "name": "Get Init Run Indicator",
                    "dependsOnList": [],
                    "isLast": 0,
                    "remark": "The initiation includes the following steps:\n1. Set Environment to source Environment, in case entity should be synced from source\n2. Set Sync Mode based on task's parameters\n3. Get Entity from Fabric\n4. Set Environment to Target Environment\n5. Set task parameters as session variables:\n5.1 Source Environment\n5.2 Target Environment\n5.3 Sync Mode\n5.4 Delete Before Load Indicator\n5.5 Insert To Target Indicator\n5.6 Replace Sequence Indicator\n5.7 Masking Indicator\n5.8 Data Flux Indicator\n5.9 Hierarchy Indicator\n5.10 Root Indicator\n5.11 Parent LU Type\n5.12 Clone Indicator\n6. Set the given Globals\n7. In case of Cloning handle the Clone Number\n",
                    "actors": [
                        {
                            "name": "FabricSetRead1",
                            "actorType": {
                                "parentType": "FabricSetRead",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "SCOPE_INITIATED",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Check If Init Did Not Run",
                    "dependsOnList": [],
                    "isLast": 0,
                    "actors": [
                        {
                            "name": "IsNull1",
                            "condition": "result",
                            "actorType": {
                                "parentType": "IsNull",
                                "inputs": [],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Print Inputs",
                    "dependsOnList": [],
                    "isLast": 0,
                    "actors": [
                        {
                            "name": "Set Initiation Flag to True",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "SCOPE_INITIATED",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": "true"
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Print Inputs to Log",
                            "actorType": {
                                "parentType": "Logger",
                                "inputs": [
                                    {
                                        "name": "message",
                                        "const": "TDMOrchestrator --> Handling task with following parameters: iid: ${iid}, luType: ${luName}, syncMode: ${syncMode}"
                                    },
                                    {
                                        "name": "level",
                                        "const": "info"
                                    },
                                    {
                                        "name": "iid",
                                        "schema": {
                                            "type": "string"
                                        }
                                    },
                                    {
                                        "name": "luName",
                                        "schema": {
                                            "type": "string"
                                        }
                                    },
                                    {
                                        "name": "syncMode",
                                        "schema": {
                                            "type": "string"
                                        },
                                        "mandatory": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Get Source Environment",
                            "actorType": {
                                "parentType": "FabricSetRead",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "TDM_SOURCE_ENVIRONMENT_NAME",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Set Environment To Source",
                    "dependsOnList": [],
                    "isLast": 0,
                    "actors": [
                        {
                            "name": "Get Start Time",
                            "actorType": {
                                "parentType": "Now",
                                "inputs": [],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Set Source Environment",
                            "minHeight": 106,
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "environment",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Initiate Source Entity ID",
                            "remark": "The Source Entity ID should be initiated in case the flows fails during the next stage and before setting this ID as it is used in the Error handler",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "SOURCE_ENTITY_ID",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Initiate IID",
                            "remark": "The IID should be initiated in case the flows fails during the next stage and before setting this ID as it is used in the Error handler",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "IID",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Initiate Target Entity ID",
                            "remark": "The Target Entity ID should be initiated in case the flows fails during the next stage and before setting this ID as it is used in the Error handler",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "TARGET_ENTITY_ID",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "set Sync Mode",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "sync",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Set TDM Parameters",
                    "dependsOnList": [],
                    "isLast": 0,
                    "isTransactional": false,
                    "actors": [
                        {
                            "name": "Set Lu Name",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "LU_TYPE",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Format Start Time",
                            "actorType": {
                                "parentType": "DateFormat",
                                "inputs": [],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Set Input IID",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "INPUT_IID",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Set The given Globals",
                    "dependsOnList": [],
                    "isLast": 0,
                    "isTransactional": false,
                    "remark": "The task receives a set of  Globals, these Globals will be set at this stage to impact the run of the Entity loading.",
                    "actors": [
                        {
                            "name": "Split IID And Clone Number",
                            "minHeight": 265,
                            "actorType": {
                                "parentType": "SplitIIDAndCloneNumber_Actor",
                                "inputs": [],
                                "outputs": [
                                    {
                                        "name": "UID",
                                        "schema": {
                                            "type": "string"
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "name": "Set Start Processing Time",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "IID_START_DATETIME",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "get TDM Task Execution ID",
                            "actorType": {
                                "parentType": "getLUVariable_Actor",
                                "inputs": [
                                    {
                                        "name": "variableName",
                                        "const": "TDM_TASK_EXE_ID"
                                    }
                                ],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Get Values of Globals And Set  Indicators And IDs",
                    "dependsOnList": [],
                    "isLast": 0,
                    "isTransactional": false,
                    "actors": [
                        {
                            "name": "Get Target Environment",
                            "actorType": {
                                "parentType": "FabricSetRead",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "TDM_TAR_ENV_NAME",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Get Source Environment DC",
                            "actorType": {
                                "parentType": "DbFetchField",
                                "inputs": [
                                    {
                                        "name": "interface",
                                        "const": "TDM"
                                    },
                                    {
                                        "name": "sql",
                                        "const": "select p.data_center_name from environment_products p, task_execution_list l, tasks_logical_units u\r\nwhere l.task_execution_id=${taskExeID} and  l.task_id = u.task_id and l.lu_id = u.lu_id and u.lu_name = ${luName}\r\nand l.source_environment_id= p.environment_id and l.product_id = p.product_id\r\n"
                                    },
                                    {
                                        "name": "taskExeID",
                                        "schema": {
                                            "type": "string"
                                        }
                                    },
                                    {
                                        "name": "luName",
                                        "schema": {
                                            "type": "string"
                                        }
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Set IID",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "IID",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Set Clone No",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "clone_id",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": "0"
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Initiate Target Entity ID after IID Split",
                            "remark": "The Target Entity ID should be initiated in case the flows fails during the next stage and before setting this ID as it is used in the Error handler",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "TARGET_ENTITY_ID",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Initiate Instance ID",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "SOURCE_INSTANCE_ID",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Set Source Entity ID",
                            "minHeight": 110,
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "SOURCE_ENTITY_ID",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Set Task Execution ID",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "execution_id",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Get Instance From Fabric",
                    "dependsOnList": [
                        "Get Values of Globals And Set  Indicators And IDs"
                    ],
                    "isLast": 0,
                    "isTransactional": false,
                    "actors": [
                        {
                            "name": "Check if Source Env has DC",
                            "minHeight": 144,
                            "condition": "result",
                            "actorType": {
                                "parentType": "IsNull",
                                "inputs": [],
                                "outputs": []
                            }
                        },
                        {
                            "name": "ErrorHandler1",
                            "onError": "result",
                            "actorType": {
                                "parentType": "ErrorHandler",
                                "inputs": [
                                    {
                                        "name": "config",
                                        "const": [
                                            {
                                                "exceptionKey": "java.lang.Exception",
                                                "conditions": {
                                                    "message": ""
                                                },
                                                "actions": {
                                                    "suppress": false,
                                                    "log": true,
                                                    "flowName": "PopulateTableErrorsWithFailed"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Get Entity",
                            "actorType": {
                                "parentType": "FabricGet",
                                "inputs": [
                                    {
                                        "name": "luType",
                                        "const": null
                                    },
                                    {
                                        "name": "iid",
                                        "const": null,
                                        "isDefault": false
                                    },
                                    {
                                        "name": "syncMode",
                                        "const": null
                                    }
                                ],
                                "outputs": [
                                    {
                                        "name": "result",
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "luName": {
                                                    "type": "string"
                                                },
                                                "iid": {
                                                    "type": "string"
                                                },
                                                "version": {
                                                    "type": "integer"
                                                },
                                                "action": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "name": "Get Time After Get",
                            "actorType": {
                                "parentType": "Now",
                                "inputs": [],
                                "outputs": []
                            }
                        }
                    ]
                },
                {
                    "name": "Stage 1",
                    "dependsOnList": [
                        "Get Values of Globals And Set  Indicators And IDs"
                    ],
                    "isLast": 0,
                    "isTransactional": false,
                    "hasElse": true,
                    "actors": [
                        {
                            "name": "ErrorHandler2",
                            "onError": "result",
                            "actorType": {
                                "parentType": "ErrorHandler",
                                "inputs": [
                                    {
                                        "name": "config",
                                        "const": [
                                            {
                                                "exceptionKey": "java.lang.Exception",
                                                "conditions": {
                                                    "message": ""
                                                },
                                                "actions": {
                                                    "suppress": false,
                                                    "log": true,
                                                    "flowName": "PopulateTableErrorsWithFailed"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Get Entity with Source DC",
                            "actorType": {
                                "parentType": "DbCommand",
                                "inputs": [
                                    {
                                        "name": "interface",
                                        "const": "fabric"
                                    },
                                    {
                                        "name": "sql",
                                        "const": "get ${luName}.${iid} @ ${dcName} WITH PARALLEL=false STOP_ON_ERROR=true"
                                    },
                                    {
                                        "name": "luName",
                                        "schema": {
                                            "type": "string"
                                        }
                                    },
                                    {
                                        "name": "iid",
                                        "schema": {
                                            "type": "string"
                                        }
                                    },
                                    {
                                        "name": "dcName",
                                        "schema": {
                                            "type": "string"
                                        }
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Get Time After Get__1",
                            "actorType": {
                                "parentType": "Now",
                                "inputs": [],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Set Environment To Target",
                    "dependsOnList": [],
                    "isLast": 0,
                    "isTransactional": false,
                    "actors": [
                        {
                            "name": "Set Target Environment",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "environment",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": null,
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Initiate Entity Status",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "ENTITY_STATUS",
                                        "isDefault": false
                                    },
                                    {
                                        "name": "value",
                                        "const": "completed",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        },
                        {
                            "name": "Format Current Time",
                            "actorType": {
                                "parentType": "DateFormat",
                                "inputs": [],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        },
        {
            "stages": [
                {
                    "name": "Set End Time of Get",
                    "dependsOnList": [],
                    "isLast": 0,
                    "isTransactional": false,
                    "actors": [
                        {
                            "name": "Set End Time of Get Command",
                            "actorType": {
                                "parentType": "FabricSet",
                                "inputs": [
                                    {
                                        "name": "key",
                                        "const": "IID_AFTER_GET_DATETIME",
                                        "isDefault": false
                                    }
                                ],
                                "outputs": []
                            }
                        }
                    ]
                }
            ]
        }
    ],
    "connections": [
        {
            "leftPort": {
                "actor": "FabricSetRead1",
                "name": "result"
            },
            "rightPort": {
                "actor": "IsNull1",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Get Source Environment",
                "name": "result"
            },
            "rightPort": {
                "actor": "Set Source Environment",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Get Start Time",
                "name": "date"
            },
            "rightPort": {
                "actor": "Format Start Time",
                "name": "date"
            }
        },
        {
            "leftPort": {
                "actor": "Format Start Time",
                "name": "string"
            },
            "rightPort": {
                "actor": "Set Start Processing Time",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Split IID And Clone Number",
                "name": "cloneNo"
            },
            "rightPort": {
                "actor": "Set Clone No",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Split IID And Clone Number",
                "name": "instanceID"
            },
            "rightPort": {
                "actor": "Set IID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Split IID And Clone Number",
                "name": "UID"
            },
            "rightPort": {
                "actor": "Set Source Entity ID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Split IID And Clone Number",
                "name": "instanceID"
            },
            "rightPort": {
                "actor": "Initiate Target Entity ID after IID Split",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Split IID And Clone Number",
                "name": "UID"
            },
            "rightPort": {
                "actor": "Get Entity",
                "name": "iid"
            },
            "arrayPosition": 0
        },
        {
            "leftPort": {
                "actor": "Split IID And Clone Number",
                "name": "UID"
            },
            "rightPort": {
                "actor": "Get Entity with Source DC",
                "name": "iid"
            }
        },
        {
            "leftPort": {
                "actor": "Split IID And Clone Number",
                "name": "instanceID"
            },
            "rightPort": {
                "actor": "Initiate Instance ID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "get TDM Task Execution ID",
                "name": "variableValue"
            },
            "rightPort": {
                "actor": "Set Task Execution ID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "get TDM Task Execution ID",
                "name": "variableValue"
            },
            "rightPort": {
                "actor": "Get Source Environment DC",
                "name": "taskExeID"
            }
        },
        {
            "leftPort": {
                "actor": "Get Target Environment",
                "name": "result"
            },
            "rightPort": {
                "actor": "Set Target Environment",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Get Source Environment DC",
                "name": "result"
            },
            "rightPort": {
                "actor": "Check if Source Env has DC",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "Get Source Environment DC",
                "name": "result"
            },
            "rightPort": {
                "actor": "Get Entity with Source DC",
                "name": "dcName"
            }
        },
        {
            "leftPort": {
                "actor": "Get Time After Get",
                "name": "date"
            },
            "rightPort": {
                "actor": "Format Current Time",
                "name": "date"
            }
        },
        {
            "leftPort": {
                "actor": "Get Time After Get__1",
                "name": "date"
            },
            "rightPort": {
                "actor": "Format Current Time",
                "name": "date"
            }
        },
        {
            "leftPort": {
                "actor": "Format Current Time",
                "name": "string"
            },
            "rightPort": {
                "actor": "Set End Time of Get Command",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "iid"
            },
            "rightPort": {
                "actor": "Print Inputs to Log",
                "name": "iid"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "luName"
            },
            "rightPort": {
                "actor": "Print Inputs to Log",
                "name": "luName"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "syncMode"
            },
            "rightPort": {
                "actor": "Print Inputs to Log",
                "name": "syncMode"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "iid"
            },
            "rightPort": {
                "actor": "Initiate Source Entity ID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "iid"
            },
            "rightPort": {
                "actor": "Initiate IID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "iid"
            },
            "rightPort": {
                "actor": "Initiate Target Entity ID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "syncMode"
            },
            "rightPort": {
                "actor": "set Sync Mode",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "luName"
            },
            "rightPort": {
                "actor": "Set Lu Name",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "iid"
            },
            "rightPort": {
                "actor": "Set Input IID",
                "name": "value"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "iid"
            },
            "rightPort": {
                "actor": "Split IID And Clone Number",
                "name": "iid"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "luName"
            },
            "rightPort": {
                "actor": "get TDM Task Execution ID",
                "name": "luName"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "luName"
            },
            "rightPort": {
                "actor": "Get Source Environment DC",
                "name": "luName"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "luName"
            },
            "rightPort": {
                "actor": "Get Entity",
                "name": "luType"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "syncMode"
            },
            "rightPort": {
                "actor": "Get Entity",
                "name": "syncMode"
            }
        },
        {
            "leftPort": {
                "actor": "flowArgs",
                "name": "luName"
            },
            "rightPort": {
                "actor": "Get Entity with Source DC",
                "name": "luName"
            }
        }
    ]
}